scalar Date

enum ActiveStatus {
  ACTIVE
  INACTIVE
}

enum MCPTransportType {
  STREAM
  SSE
  STDIO
}

enum MCPServerRunOn {
  GLOBAL
  AGENT
  EDGE
}

enum RuntimeType {
  EDGE
  MCP
}

type Infra {
  nats: String
}

type System {
  id: ID!
  initialized: Boolean!
  createdAt: Date!
  updatedAt: Date!
  defaultWorkspace: Workspace
}

type Workspace {
  id: ID!
  name: String!
  createdAt: Date!
  mcpServers: [MCPServer!]
  mcpTools: [MCPTool!]
  runtimes: [Runtime!]
  toolSets: [ToolSet!]
  registryServers: [MCPRegistryServer!]
  globalRuntime: Runtime
  onboardingSteps: [OnboardingStep!]
}

type MCPServer {
  id: ID!
  name: String!
  description: String!
  repositoryUrl: String!
  transport: MCPTransportType!
  config: String!
  tools: [MCPTool!]
  runOn: MCPServerRunOn
  runtime: Runtime
  registryServer: MCPRegistryServer!
  workspace: Workspace!
}

type MCPTool {
  id: ID!
  name: String!
  description: String!
  inputSchema: String!
  annotations: String!
  status: ActiveStatus!
  createdAt: Date!
  lastSeenAt: Date!
  mcpServer: MCPServer!
  toolSets: [ToolSet!]
  workspace: Workspace!
}

type ToolSet {
  id: ID!
  name: String!
  description: String
  createdAt: Date!
  updatedAt: Date
  mcpTools: [MCPTool!]
  workspace: Workspace!
}

type Runtime {
  id: ID!
  name: String!
  description: String
  status: ActiveStatus!
  type: RuntimeType!
  createdAt: Date!
  lastSeenAt: Date
  roots: String
  mcpServers: [MCPServer!]
  workspace: Workspace!
  hostIP: String
  hostname: String
  mcpClientName: String
}

enum OnboardingStepType {
  ONBOARDING
  ANNOUNCEMENT
  LEARNING
}

enum OnboardingStepStatus {
  PENDING
  COMPLETED
  DISMISSED
}

enum ToolCallStatus {
  PENDING
  COMPLETED
  FAILED
}

type OnboardingStep {
  id: ID!
  stepId: String!
  type: OnboardingStepType!
  status: OnboardingStepStatus!
  priority: Int
  createdAt: Date!
  updatedAt: Date
}

type ToolCall {
  id: ID!
  toolInput: String!
  calledAt: Date!
  completedAt: Date
  status: ToolCallStatus!
  toolOutput: String
  error: String
  mcpTool: MCPTool!
  calledBy: Runtime!
  executedBy: Runtime
}

type User {
  id: ID!
  email: String!
  createdAt: Date!
  updatedAt: Date!
  lastLoginAt: Date
  adminOfWorkspaces: [Workspace!]
  membersOfWorkspaces: [Workspace!]
}

type AuthPayload {
  user: User!
  accessToken: String!
  refreshToken: String!
  expiresIn: Int!
}

type RefreshTokenPayload {
  accessToken: String!
  expiresIn: Int!
}

input LoginInput {
  email: String!
  password: String!
  deviceInfo: String
}

input RefreshTokenInput {
  refreshToken: String!
}

input LogoutInput {
  refreshToken: String!
}

type MCPRegistryServer {
  id: ID!
  name: String!
  description: String!
  title: String!
  repositoryUrl: String!
  version: String!
  packages: String
  remotes: String
  _meta: String
  createdAt: Date!
  lastSeenAt: Date!
  workspace: Workspace!
  configurations: [MCPServer!]
}

# Monitoring types for scalable tool call queries
input ToolCallFilters {
  status: [ToolCallStatus!]
  mcpToolIds: [ID!]
  mcpServerIds: [ID!]
  runtimeIds: [ID!]
  dateFrom: Date
  dateTo: Date
  search: String
}

enum OrderDirection {
  ASC
  DESC
}

type ToolCallsResult {
  toolCalls: [ToolCall!]!
  totalCount: Int!
  hasMore: Boolean!
  stats: ToolCallStats!
}

type ToolCallStats {
  total: Int!
  pending: Int!
  completed: Int!
  failed: Int!
  avgDuration: Float
}

type Query {
  workspace: [Workspace!]
  mcpServers(workspaceId: ID!): [MCPServer!]
  mcpTools(workspaceId: ID!): [MCPTool!]
  toolSets(workspaceId: ID!): [ToolSet!]
  system: System
  infra: Infra!
  workspaceMCPTools(workspaceId: ID!): Workspace
  isMCPAutoConfigEnabled: Boolean!
  getRegistryServers(workspaceId: ID!): [MCPRegistryServer!]!
  # Monitoring query with filtering and pagination
  toolCalls(
    workspaceId: ID!
    limit: Int
    offset: Int
    filters: ToolCallFilters
    orderDirection: OrderDirection
  ): ToolCallsResult!
  # Authentication queries
  me: User
}

type CallToolResult {
  success: Boolean!
  result: String!
}

type Mutation {
  createMCPServer(
    name: String!
    description: String!
    repositoryUrl: String!
    transport: MCPTransportType!
    config: String!
    runOn: MCPServerRunOn
    workspaceId: ID!
    registryServerId: ID!
  ): MCPServer!
  updateMCPServer(
    id: ID!
    name: String!
    description: String!
    repositoryUrl: String!
    transport: MCPTransportType!
    config: String!
    runOn: MCPServerRunOn
  ): MCPServer!
  linkMCPServerToRuntime(mcpServerId: ID!, runtimeId: ID!): MCPServer!
  unlinkMCPServerFromRuntime(mcpServerId: ID!): MCPServer!
  createRuntime(name: String!, description: String!, type: RuntimeType!, workspaceId: ID!): Runtime!
  updateRuntime(id: ID!, name: String!, description: String!): Runtime!
  deleteRuntime(id: ID!): Runtime!
  deleteMCPTool(id: ID!): MCPTool!
  deleteMCPServer(id: ID!): MCPServer!
  # ToolSet mutations
  createToolSet(name: String!, description: String!, workspaceId: ID!): ToolSet!
  updateToolSet(id: ID!, name: String!, description: String!): ToolSet!
  deleteToolSet(id: ID!): ToolSet!
  addMCPToolToToolSet(mcpToolId: ID!, toolSetId: ID!): ToolSet!
  removeMCPToolFromToolSet(mcpToolId: ID!, toolSetId: ID!): ToolSet!
  initSystem(adminPassword: String!, email: String!): System!
  updateWorkspace(id: ID!, name: String!): Workspace!
  setGlobalRuntime(id: ID!, runtimeId: ID!): Workspace!
  unsetGlobalRuntime(id: ID!): Workspace!
  updateMCPServerRunOn(mcpServerId: ID!, runOn: MCPServerRunOn!, runtimeId: ID): MCPServer!

  # Registry server mutations
  addServerToRegistry(
    workspaceId: ID!
    name: String!
    description: String!
    title: String!
    repositoryUrl: String!
    version: String!
    packages: String
    remotes: String
  ): MCPRegistryServer!
  updateServerInRegistry(
    serverId: ID!
    name: String
    description: String
    title: String
    repositoryUrl: String
    version: String
    packages: String
    remotes: String
  ): MCPRegistryServer!
  removeServerFromRegistry(serverId: ID!): MCPRegistryServer!

  # Playground mutations
  callMCPTool(toolId: ID!, input: String!): CallToolResult!

  # Onboarding mutations
  completeOnboardingStep(workspaceId: ID!, stepId: String!): Boolean!
  dismissOnboardingStep(workspaceId: ID!, stepId: String!): Boolean!

  # Authentication mutations
  registerUser(input: RegisterUserInput!): RegisterUserPayload!
  loginUser(input: LoginUserInput!): AuthPayload!
  login(input: LoginInput!): AuthPayload!
  refreshToken(input: RefreshTokenInput!): RefreshTokenPayload!
  logout(input: LogoutInput!): Boolean!
  logoutUser(input: LogoutUserInput!): LogoutPayload!
}

# Authentication types
type User {
  id: ID!
  email: String!
  createdAt: Date!
  lastLoginAt: Date
}

type AuthTokens {
  accessToken: String!
  refreshToken: String!
}

type AuthPayload {
  success: Boolean!
  user: User
  tokens: AuthTokens
  errors: [String!]
}

type RegisterUserPayload {
  success: Boolean!
  user: User
  tokens: AuthTokens
  errors: [String!]
}

type RefreshTokenPayload {
  success: Boolean!
  accessToken: String
  errors: [String!]
}

type LogoutPayload {
  success: Boolean!
  errors: [String!]
}

input RegisterUserInput {
  email: String!
  password: String!
  deviceInfo: String
}

input LoginUserInput {
  email: String!
  password: String!
  deviceInfo: String
}

input LoginInput {
  email: String!
  password: String!
  deviceInfo: String
}

input RefreshTokenInput {
  refreshToken: String!
}

input LogoutUserInput {
  refreshToken: String!
}

input LogoutInput {
  refreshToken: String!
}

type Subscription {
  workspaces: [Workspace!]
  workspace(workspaceId: ID!): Workspace
  runtimes(workspaceId: ID!): [Runtime!]
  mcpServers(workspaceId: ID!): [MCPServer!]
  mcpTools(workspaceId: ID!): [MCPTool!]
  toolSets(workspaceId: ID!): [ToolSet!]
  toolCalls(workspaceId: ID!): [ToolCall!]
}
